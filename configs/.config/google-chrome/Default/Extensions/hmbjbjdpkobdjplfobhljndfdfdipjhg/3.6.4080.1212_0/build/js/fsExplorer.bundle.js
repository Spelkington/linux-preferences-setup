!function(e){function t(t){for(var l,s,n=t[0],o=t[1],c=t[2],d=0,u=[];d<n.length;d++)s=n[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&u.push(r[s][0]),r[s]=0;for(l in o)Object.prototype.hasOwnProperty.call(o,l)&&(e[l]=o[l]);for(h&&h(t);u.length;)u.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],l=!0,n=1;n<a.length;n++){var o=a[n];0!==r[o]&&(l=!1)}l&&(i.splice(t--,1),e=s(s.s=a[0]))}return e}var l={},r={2:0},i=[];function s(t){if(l[t])return l[t].exports;var a=l[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=l,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)s.d(a,l,function(t){return e[t]}.bind(null,l));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var n=window.webpackJsonp=window.webpackJsonp||[],o=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var h=o;i.push([96,0]),a()}({4:function(e,t,a){"use strict";function l(e){const t=(a=e,{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[Object.prototype.toString.call(a)]);var a;let r;if("array"===t)r=[];else{if("object"!==t)return e;r={}}if("array"===t)for(let t=0;t<e.length;t++)r.push(l(e[t]));else if("object"===t)for(let t in e)r[t]=l(e[t]);return r}a.d(t,"a",(function(){return l}))},6:function(e,t,a){var l=a(74);"string"==typeof l&&(l=[[e.i,l,""]]),l.locals&&(e.exports=l.locals);(0,a(2).default)("6c1ecc64",l,!1,{})},73:function(e,t,a){"use strict";var l=a(6);a.n(l).a},74:function(e,t,a){(e.exports=a(1)(!1)).push([e.i,"",""])},96:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"h5fs-app"}},[a("div",{staticClass:"fileManager",attrs:{id:"h5fs-i-page"}},[a("div",{staticClass:"h5fs-i-sidebar"},[a("Tree",{ref:"Tree",attrs:{size:"large",data:e.baseData,columns:e.columns4},on:{"on-select-change":e.getChecked}})],1),e._v(" "),a("div",{ref:"a",attrs:{id:"h5fs-i-wrap"}},[a("Table",{ref:"selection",attrs:{columns:e.columns4,data:e.listData},on:{"on-row-dblclick":e.rowdbClick,"on-row-click":e.rowClick}})],1),e._v(" "),a("div",{staticClass:"h5fs-i-edit"},[a("button",{staticClass:"ivu-btn",attrs:{id:"ivu-download"},on:{click:e.downloadFile}},[e._v("download")]),e._v(" "),a("button",{staticClass:"ivu-btn",attrs:{id:"ivu-remove"},on:{click:e.removeFile}},[e._v("remove")])])])])};l._withStripped=!0;var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.wrapClasses},[a("div",{class:e.classes},[a("div",{ref:"header",class:[e.prefixCls+"-header"]},[a("table-head",{attrs:{"prefix-cls":e.prefixCls,styleObject:e.tableStyle,columns:e.cloneColumns,"obj-data":e.objData,data:e.rebuildData,"columns-width":e.columnsWidth}})],1),e._v(" "),a("div",{ref:"body",class:[e.prefixCls+"-body"]},[a("table-body",{ref:"tbody",attrs:{"prefix-cls":e.prefixCls,styleObject:e.tableStyle,columns:e.cloneColumns,data:e.rebuildData,"columns-width":e.columnsWidth,"obj-data":e.objData}})],1)])])};r._withStripped=!0;var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("table",{attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("colgroup",e._l(e.columns,(function(t,l){return a("col",{attrs:{width:e.setCellWidth(t)}})})),0),e._v(" "),a("thead",e._l(e.headRows,(function(t,l){return a("tr",e._l(t,(function(t,l){return a("th",{attrs:{colspan:t.colSpan,rowspan:t.rowSpan}},[a("div",{class:e.cellClasses(t)},["selection"===t.type?[a("input",{attrs:{type:"checkbox",disabled:!e.data.length},domProps:{checked:e.isSelectAll},on:{click:e.selectAll}})]:[a("span",[e._v(e._s(t.title))])]],2)])})),0)})),0)])};i._withStripped=!0;var s={methods:{setCellWidth(e){let t="";return e.width?t=e.width:this.columnsWidth[e._index]&&(t=this.columnsWidth[e._index].width),"0"===t&&(t=""),t}}},n={name:"TableHead",mixins:[s],props:{prefixCls:String,styleObject:Object,columns:Array,objData:Object,data:Array,columnsWidth:Object,columnRows:Array},computed:{isSelectAll(){let e=!0;this.data.length||(e=!1);for(let t=0;t<this.data.length;t++)if(!this.objData[this.data[t]._index]._isChecked){e=!1;break}return e},headRows(){return[this.columns]}},methods:{cellClasses(e){return[`${this.prefixCls}-cell`,{[`${this.prefixCls}-cell-with-selection`]:"selection"===e.type}]},selectAll(){const e=!this.isSelectAll;this.$parent.selectAll(e);for(let t=0;t<this.data.length;t++)this.objData[this.data[t]._index]._isChecked=e}}},o=a(0),c=Object(o.a)(n,i,[],!1,null,null,null);c.options.__file="src/app/vue/components/table/table-head.vue";var h=c.exports,d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("table",{style:e.styleObject,attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("colgroup",e._l(e.columns,(function(t,l){return a("col",{attrs:{width:e.setCellWidth(t)}})})),0),e._v(" "),a("tbody",{class:[e.prefixCls+"-tbody"]},[e._l(e.data,(function(t,l){return[a("table-tr",{key:t._rowKey,attrs:{row:t,"prefix-cls":e.prefixCls},nativeOn:{click:function(a){return e.clickCurrentRow(t._index)},dblclick:function(a){return a.stopPropagation(),e.dblclickCurrentRow(t._index)}}},e._l(e.columns,(function(r){return a("td",[a("table-cell",{key:r._columnKey,attrs:{"prefix-cls":e.prefixCls,row:t,type:r,column:r,"natural-index":l,index:t._index,checked:e.rowChecked(t._index)}})],1)})),0)]}))],2)])};d._withStripped=!0;var u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"cell",class:e.classes},["selection"===e.column.type?[a("input",{attrs:{type:"checkbox",name:e.name},domProps:{checked:e.currentValue},on:{click:e.click}})]:"type"===e.column.key?[a("span",[e._v(e._s(e.row.isFile?"file":"folder"))])]:[a("span",[e._v(e._s(e.row[e.column.key]))])]],2)};u._withStripped=!0;var p={name:"TableCell",props:{prefixCls:String,row:Object,column:Object,naturalIndex:Number,index:Number,checked:Boolean,currentValue:Boolean},data(){return{name:" ",renderType:"",uid:-1,context:this.$parent.$parent.$parent.currentContext}},computed:{classes(){return[`${this.prefixCls}-cell`,{[`${this.prefixCls}-cell-with-selection`]:"selection"===this.column.type}]}},methods:{click(e){e.target.checked=!e.target.checked}}},f=Object(o.a)(p,u,[],!1,null,null,null);f.options.__file="src/app/vue/components/table/cell.vue";var m=f.exports,b=function(){var e=this.$createElement;return(this._self._c||e)("tr",{class:this.rowClasses(this.row._index)},[this._t("default")],2)};b._withStripped=!0;var v={props:{row:Object,prefixCls:String},computed:{objData(){return this.$parent.objData}},methods:{rowClasses(e){return[{[`${this.prefixCls}-row`]:this.objData[e]._isChecked}]}}},y=Object(o.a)(v,b,[],!1,null,null,null);y.options.__file="src/app/vue/components/table/table-tr.vue";var _={name:"TableBody",mixins:[s],components:{TableCell:m,TableTr:y.exports},props:{prefixCls:String,styleObject:Object,columns:Array,data:Array,objData:Object,columnsWidth:Object},methods:{rowChecked(e){return this.objData[e]&&this.objData[e]._isChecked},clickCurrentRow(e){this.$parent.clickCurrentRow(e)},dblclickCurrentRow(e){this.$parent.dblclickCurrentRow(e)}}},g=Object(o.a)(_,d,[],!1,null,null,null);g.options.__file="src/app/vue/components/table/table-body.vue";var w=g.exports,D=a(4);let x=1;var k={name:"Table",components:{tableHead:h,tableBody:w},props:{data:{type:Array,default:()=>[]},columns:{type:Array,default:()=>[]},width:{type:[Number,String]},height:{type:[Number,String]},context:{type:Object}},data(){const e=this.columns;return{ready:!1,tableWidth:0,columnsWidth:{},prefixCls:"ivu-table",objData:this.makeObjData(),rebuildData:[],cloneColumns:this.makeColumns(e),bodyHeight:0,currentContext:this.context,cloneData:this.data}},computed:{wrapClasses:()=>["ivu-table-wrapper"],classes:()=>["ivu-table"],tableStyle(){let e={};if(0!==this.tableWidth){let t="";t=this.tableWidth,e.width=`${t}px`}return e}},methods:{handleResize(){for(let e=0;e<this.cloneColumns.length;e++){const t=this.cloneColumns[e];let a=t.width;t._width=a}},clickCurrentRow(e){this.$emit("on-row-click",JSON.parse(JSON.stringify(this.cloneData[e])),e)},dblclickCurrentRow(e){this.$emit("on-row-dblclick",JSON.parse(JSON.stringify(this.cloneData[e])),e)},getSelection(){let e=[];for(let t in this.objData)this.objData[t]._isChecked&&e.push(parseInt(t));return JSON.parse(JSON.stringify(this.data.filter((t,a)=>e.indexOf(a)>-1)))},selectAll(e){for(const t of this.rebuildData)this.$children[1].$children[t._index].$children[0].$refs.cell.children[0].checked=e;this.getSelection()},makeData(){let e=this.data;return e.forEach((e,t)=>{e._index=t,e._rowKey=x++}),e},makeObjData(){let e={};return this.data.forEach((t,a)=>{const l=Object(D.a)(t);l._checked?l._isChecked=l._checked:l._isChecked=!1,e[a]=l}),e},makeColumns(e){let t=[];return e.forEach((e,a)=>{t.push(e)}),t}},created(){this.context||(this.currentContext=this.$parent)},mounted(){this.handleResize(),this.$nextTick(()=>this.ready=!0)},watch:{data:{handler(){this.objData=this.makeObjData(),this.rebuildData=this.makeData(),this.handleResize(),setTimeout(()=>{this.cloneData=this.data},0)},deep:!0},columns:{handler(){const e=this.columns;this.cloneColumns=this.makeColumns(e),this.rebuildData=this.makeData(),this.handleResize()},deep:!0},height(){this.handleResize()}}},C=Object(o.a)(k,r,[],!1,null,null,null);C.options.__file="src/app/vue/components/table/table.vue";var j=C.exports,$=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.prefixCls},e._l(e.stateTree,(function(t,l){return a("Tree-node",{key:l,attrs:{data:t,visible:"","children-key":e.childrenKey}})})),1)};$._withStripped=!0;var S=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ul",[a("li",{class:e.classes,attrs:{id:"ivu-li"},on:{click:e.handleSelect}},[e.root?a("span",{attrs:{id:"ivu-ul-span"}}):e._l(e.data.entry.fullPath.split("/"),(function(e,t){return a("span",{key:t,attrs:{id:"ivu-ul-span"}})})),e._v(" "),a("span",{class:e.arrowClasses,on:{click:e.handleExpand}},[e.showArrow?a("div",{staticClass:"ivu-icon-ios-arrow-forward"}):e._e()]),e._v(" "),a("span",{class:e.titleClasses},[e._v(e._s(e.data.title))])],2),e._v(" "),e._l(e.children,(function(t,l){return e.data.expand?a("Tree-node",{key:l,attrs:{data:t,"children-key":e.childrenKey}}):e._e()}))],2)};function O(e,t,a){this.$children.forEach(l=>{l.$options.name===e?l.$emit.apply(l,[t].concat(a)):O.apply(l,[e,t].concat([a]))})}S._withStripped=!0;var T={name:"TreeNode",mixins:[{methods:{dispatch(e,t,a){let l=this.$parent||this.$root,r=l.$options.name;for(;l&&(!r||r!==e);)(l=l.$parent)&&(r=l.$options.name);l&&l.$emit.apply(l,[t].concat(a))},broadcast(e,t,a){O.call(this,e,t,a)}}}],props:{data:{type:Object,default:()=>({})},childrenKey:{type:String,default:"children"}},data:()=>({prefixCls:"ivu-tree",list:[]}),computed:{classes(){return[{"ivu-tree-title-selected":this.data.selected}]},arrowClasses(){return["ivu-tree-arrow",{"ivu-tree-arrow-open":this.data.expand}]},titleClasses(){return["ivu-tree-title",{"ivu-tree-title-selected":this.data.selected}]},showArrow(){return this.data[this.childrenKey]&&this.data[this.childrenKey].length},root(){return"/"==this.data.entry.fullPath},children(){return this.data[this.childrenKey]}},methods:{handleExpand(){const e=this.data;e[this.childrenKey]&&e[this.childrenKey].length&&this.$set(this.data,"expand",!this.data.expand)},handleSelect(){this.dispatch("Tree","on-selected",this.data.nodeKey)}}},P=Object(o.a)(T,S,[],!1,null,null,null);P.options.__file="src/app/vue/components/tree/node.vue";var E=P.exports;var K={name:"Tree",components:{TreeNode:E},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},childrenKey:{type:String,default:"children"},render:{type:Function}},data(){return{prefixCls:"ivu-tree",stateTree:this.data,flatState:[]}},watch:{data:{deep:!0,handler(){this.stateTree=this.data,this.flatState=this.compileFlatState()}}},methods:{compileFlatState(){let e=0,t=this.childrenKey;const a=[];return this.stateTree.forEach(l=>{!function l(r,i){r.nodeKey=e++,a[r.nodeKey]={node:r,nodeKey:r.nodeKey},void 0!==i&&(a[r.nodeKey].parent=i.nodeKey,a[i.nodeKey][t].push(r.nodeKey)),r[t]&&(a[r.nodeKey][t]=[],r[t].forEach(e=>l(e,r)))}(l)}),a},getSelectedNodes(){return this.flatState.filter(e=>e.node.selected).map(e=>e.node)},getCheckedNodes(){return this.flatState.filter(e=>e.node.checked).map(e=>e.node)},handleSelect(e){const t=this.flatState[e].node;if(!this.multiple){const t=this.flatState.findIndex(e=>e.node.selected);t>=0&&t!==e&&this.$set(this.flatState[t].node,"selected",!1)}this.$set(t,"selected",!t.selected),this.$emit("on-select-change",this.getSelectedNodes(),t)}},created(){this.flatState=this.compileFlatState()},mounted(){this.$on("on-selected",this.handleSelect)}},N=Object(o.a)(K,$,[],!1,null,null,null);N.options.__file="src/app/vue/components/tree/tree.vue";var A={name:"fileManager",components:{Tree:N.exports,Table:j},data:()=>({columns4:[{type:"selection",width:60},{title:"Name",key:"name",width:350},{title:"Size",key:"size",width:200},{title:"Type",key:"type",width:100},{title:"lastModifiedTime",key:"Time",width:250}],baseData:[{title:"root",expand:!0,selected:!0,children:[],entry:{isDirectory:!0,fullPath:"/"},fullPath:"/"}],listData:[],arrData:[],removeData:[],root:null,str:[],f:[],fileData:[],i:0}),methods:{readDir(e){var t=this;t.f.readdir(e,{deep:!0}).then(e=>{e.length<=19?t.tableData(e):(t.tableData(e.slice(0,19)),t.fileData=e.slice(19,e.length))}).catch(e=>{console.log("catch "+e)})},tableData(e){var t=this;e.forEach((function(e){t.f.stat(e.fullPath).then(e=>{let a=e.size,l=" B";a>1024&&(l=" KB",(a=(a/1024).toFixed(1))>1024&&(a=(a/1024).toFixed(1),l=" MB")),e.size=a+l,e.Time=e.modificationTime.toLocaleString(),e.Time=e.Time.replace("上午","AM"),e.Time=e.Time.replace("下午","PM"),t.listData.push(e)}).catch(e=>{console.log("catch "+e)})}))},find(e,t,a){for(var l=0;l<e.length;l++)e[l].entry.fullPath!==t?e[l].children&&this.find(e[l].children,t,a):e[l].selected=a},downloadFile(){var e=this;this.removeData=[];for(let e=0;e<this.$refs.selection.data.length;e++)this.$refs.selection.$refs.tbody.objData[e]._isChecked&&this.removeData.push(this.$refs.selection.$refs.tbody.objData[e]);chrome.fileSystem.chooseEntry({type:"openDirectory"},(function(t){console.log(t),chrome.runtime.lastError?console.warn(chrome.runtime.lastError.message):function t(a,l){for(let r=0;r<l.length;r++)l[r].isFile?a.getFile(l[r].name,{create:!0,exclusive:!1},(function(t){e.f.getEntry(l[r].fullPath).then(a=>{a.file(a=>{e.f.writeFile(t,a)})})}),(function(e){console.warn("errormsg"+e.name+" "+e.message)})):l[r].isDirectory&&a.getDirectory(l[r].name,{create:!0,exclusive:!1},(function(a){e.f.readdir(l[r].fullPath).then(e=>t(a,e)).catch(e=>{console.log("catch "+e)})}),(function(e){console.warn("errormsg"+e.name+" "+e.message)}))}(t,e.removeData)}))},rowClick(e,t){this.$children[1].$children[1].objData[t]._isChecked=!this.$children[1].$children[1].objData[t]._isChecked,this.$children[1].$children[1].$children[t].$children[0].$refs.cell.children[0].checked=!this.$children[1].$children[1].$children[t].$children[0].$refs.cell.children[0].checked},rowdbClick(e,t){if(1==e.isDirectory){this.listData=[],this.fileData=[],this.readDir(e.fullPath);var a=this.$refs.Tree.getSelectedNodes()[0].entry.fullPath;this.find(this.$refs.Tree.data,e.fullPath,!0),this.find(this.$refs.Tree.data,a,!1)}},getChecked(){this.listData=[],this.fileData=[];var e=this.$refs.Tree.getSelectedNodes();0!=e.length&&e[0].entry.isDirectory&&(e[0].expand=!0,this.readDir(e[0].entry.fullPath))},removeFile(){this.removeData=[];for(let e=0;e<this.$refs.selection.data.length;e++)this.$refs.selection.$refs.tbody.objData[e]._isChecked&&this.removeData.push(this.$refs.selection.$refs.tbody.objData[e]);for(let a=0;a<this.removeData.length;a++){function e(t,a){for(var l=0;l<t.length;l++)t[l].entry.fullPath!==a?t[l].children&&e(t[l].children,a):t.splice(l,1)}function t(t,a){for(var l=0;l<t.length;l++)t[l].fullPath!==a?t[l].children&&e(t[l].children,a):t.splice(l,1)}this.removeData[a].isDirectory?this.f.rmdir(this.removeData[a].fullPath):this.removeData[a].isFile&&this.f.unlink(this.removeData[a].fullPath),e(this.baseData,this.removeData[a].fullPath),t(this.listData,this.removeData[a].fullPath)}this.removeData=[]},getTree(){var e=this;e.f=fs,commonModule.getFS().then(e=>e.readdir("/",{deep:!0})).then(e=>this.makeTreeData(e)).then(t=>e.baseData[0].children=t).then(t=>e.baseData[0].entry.children=t).then(()=>this.getChecked()).catch(e=>{console.log("catch "+e)})},makeTreeData(e){var t=this,a=[];return e.forEach((function(e){if(e.isDirectory){var l={title:e.name,entry:e,expand:!1,selected:!1,children:e.children?t.makeTreeData(e.children):null,url:e.toURL()};a.push(l)}})),a},onScroll(){var e=this.$refs.a.scrollTop,t=this.$refs.a.scrollHeight;e+this.$refs.a.clientHeight>=t-10&&(this.tableData(this.fileData.slice(0,19)),this.fileData.length>19?this.fileData=this.fileData.slice(19,this.fileData.length):this.fileData=[])}},mounted:function(){this.getTree(),this.$refs.a.addEventListener("scroll",this.onScroll)}},F=(a(73),Object(o.a)(A,l,[],!1,null,null,null));F.options.__file="src/app/vue/views/fsExplorer/FileExpoler.vue";var R=F.exports;new(a(5).a)({el:"#h5fs-app",render:e=>e(R)})}});